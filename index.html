<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>WEB API &amp; SendGrid API Integration by AndreiSpatariu</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>WEB API &amp; SendGrid API Integration</h1>
        <h2>A step by step guide towards creating a Web Application that uses SendGrid to send a mail to a designated email address</h2>
        <a href="https://github.com/AndreiSpatariu/WebApiMailDemo" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>

<p>In this workshop we will take a look at how we can make use of Web API, .NET MVC and an email delivery and management service to implement an email sending web app.
We will be building the app from the ground up, and hopefully by the end of it you will manage to have a fully functional spam machine to impress and annoy any of your friends.</p>

<h2>
<a id="conceptstechnologies-used-in-this-workshop" class="anchor" href="#conceptstechnologies-used-in-this-workshop" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Concepts/Technologies used in this workshop</h2>

<p>-<a href="https://www.asp.net/web-api">ASP.NET Web API</a></p>

<p>-<a href="https://www.asp.net/mvc">ASP.NET MVC</a></p>

<p>-<a href="https://sendgrid.com/docs/API_Reference/Web_API/">SendGrid API</a></p>

<h2>
<a id="what-is-web-api" class="anchor" href="#what-is-web-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is Web API?</h2>

<p>ASP.NET Web API is a framework that makes it easy to build <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP</a> services that reach a broad range of clients, including browsers and mobile devices. <a href="https://www.asp.net/">ASP.NET</a> Web API is an ideal platform for building <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a> applications on the .NET Framework.</p>

<p><a href="https://www.asp.net/web-api">More on the official ASP.NET Microsoft Documentation Website</a></p>

<h2>
<a id="what-is-mvc" class="anchor" href="#what-is-mvc" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is MVC?</h2>

<p>Model-View-Controller (MVC) is a software architecture - the structure of the system - that separates domain/application/business (whatever you prefer) logic from the rest of the user interface. It does this by separating the application into three parts: the model, the view, and the controller.</p>

<p>The model manages fundamental behaviors and data of the application. It can respond to requests for information, respond to instructions to change the state of its information, and even to notify observers in event-driven systems when information changes. This could be a database, or any number of data structures or storage systems. In short, it is the data and data-management of the application.</p>

<p>The view effectively provides the user interface element of the application. It'll render data from the model into a form that is suitable for the user interface.</p>

<p>The controller receives user input and makes calls to model objects and the view to perform appropriate actions.</p>

<p>All in all, these three components work together to create the three basic components of MVC.</p>

<h2>
<a id="what-is-sendgrid" class="anchor" href="#what-is-sendgrid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is SendGrid?</h2>

<p>SendGrid is a transactional email delivery and management service. Basically, its API allows you to send automated emails to a large number of clients, and these types of services are behind most of the mail you receive from online stores, social media websites and so forth.</p>

<h2>
<a id="lets-get-started" class="anchor" href="#lets-get-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Let's get started</h2>

<p>As I said, we will be starting from scratch, so we need to fire up <a href="https://www.visualstudio.com/">Visual Studio</a> and create a new project. Select ASP.NET Web Application under the Visual C#'s Web tab. Next, we select Web API and tick the checkboxes for MVC and Web API under <code>Add folders and core references for:</code>. What  this does is that it creates a template for the project, adding the folders and references for a MVC based project. Now we should be all set-up to start writing some code.</p>

<h2>
<a id="creating-the-model" class="anchor" href="#creating-the-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating the Model</h2>

<p>The model is the bread and butter of our application. What it does is that it manages the data, logic and rules of our application. For this demo, we won't be going too much in depth with this concept, because the model we need for our mail-spamming machine is a very basic one. Remember that we ticked that MVC checkbox when we created the project? Well, now we should be able to see a <code>Models</code> folder in our solution explorer. We will create our model there, so create a new class in that folder and we will name it <code>EmailData</code>.
Due to the fact that we do not need a complicated model, we can just go with a few properties that we need in order to send our mail:</p>

<pre><code>public class EmailData
    {
        public string ToEmailAddress { get; set; }
        public string FromEmailAddress { get; set; }
        public string Content { get; set; }
        public string Subject { get; set; }
    }
</code></pre>

<p>This is our model. We need a <code>ToEmailAddress</code> so we know where to send the mail, a <code>FromEmailAddress</code> so the person receiving it knows where it comes from, the <code>Content</code> of the mail and a <code>Subject</code>.</p>

<h2>
<a id="integrating-sendgrid-api" class="anchor" href="#integrating-sendgrid-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Integrating SendGrid API</h2>

<p>To install SendGrid, run the following command in the <a href="https://docs.nuget.org/ndocs/tools/package-manager-console">Package Manager Console</a>: <code>Install-Package Sendgrid</code>. Next, we need a class that will act as a 'Sender' for our email and for that we will create a new folder called <code>Senders</code> since it does not belong in any of the ones that we already have. Inside of that folder we will create our class called <code>EmailSender</code>, we will use the API integration example from <a href="https://github.com/sendgrid/sendgrid-csharp">SendGrid's official library</a> and adapt it to our own model.</p>

<p>So, this is our class:</p>

<pre><code>using System;
using SendGrid;
using SendGrid.Helpers.Mail;
using System.Threading.Tasks;

namespace Example
{
    internal class Example
    {
        private static void Main()
        {
            Execute().Wait();
        }

        public static async Task SendMail(EmailData emailData)
        {
            string apiKey = "YOUR_API_KEY_HERE";
            var sg = new SendGridAPIClient(apiKey);

            Email from = new Email(emailData.FromName);
            string subject = emailData.Subject;
            Email to = new Email(emailData.EmailAddress);
            Content content = new Content("text/plain", emailData.Content);
            Mail mail = new Mail(from, subject, to, content);

            var response = await sg.client.mail.send.post(requestBody: mail.Get());
        }
    }
}
</code></pre>

<p>Note that you have to replace <code>YOUR_API_KEY_HERE</code> with <code>you guessed it</code>, your own key, and for that you need a SendGrid account. Luckily, you can get a free subscription that allows you to send 15 000 mails/month using the <a href="https://education.github.com/pack">GitHub Student Pack</a>. You can get more information on what API Keys are and how to create one from the <a href="https://sendgrid.com/docs/User_Guide/Settings/api_keys.html">Official SendGrid Documentation</a>.</p>

<h2>
<a id="creating-our-controller" class="anchor" href="#creating-our-controller" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating our Controller</h2>

<p>The <code>Controller</code> is the "controlled" way through which the user interacts with the <code>Model</code>. For our example, we just need one simple method that will receive an object from our <code>View</code> and will call the method that we have just created in our <code>Sender</code>.
This is our class:</p>

<pre><code>public class EmailController : ApiController
{
    [HttpPost]
    public IHttpActionResult SendEmail(EmailData emailData)
    {
        EmailSender.SendMail(emailData).Wait();

        return Ok();
    }
}
</code></pre>

<h2>
<a id="creating-the-view" class="anchor" href="#creating-the-view" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating the View</h2>

<p>The <code>View</code> is what the user sees and where he inputs the data that is sent to the <code>Controller</code>. This is our View:</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
&lt;head&gt;
    &lt;title&gt;Email Sender App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Send an email to anyone in our database&lt;/h1&gt;
    &lt;div&gt;
        &lt;h2&gt;Your Name:&lt;/h2&gt;
        &lt;input type="text" id="fromName" size="5" style="width: 100px" /&gt;
        &lt;h2&gt;Their Email Address:&lt;/h2&gt;
        &lt;input type="text" id="emailAddress" size="5" style="width: 100px" /&gt;
        &lt;h2&gt;Subject:&lt;/h2&gt;
        &lt;input type="text" id="subject" size="5" style="width: 100px" /&gt;
        &lt;h2&gt;Content:&lt;/h2&gt;
        &lt;input type="text" id="content" size="5" style="width: 100px" /&gt;
        &lt;input type="button" value="Send Email" onclick="sendEmail()" /&gt;
    &lt;/div&gt;

    &lt;script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"&gt;&lt;/script&gt;
    &lt;script&gt;

    function sendEmail()
    {
        var fromName = $('#fromName').val();
        var subject = $('#subject').val();
        var emailAddress = $('#emailAddress').val();
        var content = $('#content').val()

        var emailData = {
            FromName: fromName,
            EmailAddress: emailAddress,
            Content: content,
            Subject: subject
        }

        $.ajax({
            type: "POST",
            url: 'api/email',
            data: emailData
        });
    }

    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/AndreiSpatariu/WebApiMailDemo/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/AndreiSpatariu/WebApiMailDemo/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/AndreiSpatariu/WebApiMailDemo"></a> is maintained by <a href="https://github.com/AndreiSpatariu">AndreiSpatariu</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
